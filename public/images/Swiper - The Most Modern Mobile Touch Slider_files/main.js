function init(i){var e="https://api.apitiny.net/";i=i?.getAttribute("site-id")||i?.getAttribute("data-site-id")||"%siteId";let s={GET_AS:e+"api/gas",GET_SITE_CONFIG:e+"api/gsc"};e="ontouchstart"in window||0<navigator.maxTouchPoints||window.matchMedia("(pointer: coarse)").matches;let g="ta-ad-container";var t=document.body.clientHeight-window.innerHeight<100;let n=t?5:e?2:15,m=t?0:Math.max(10,.1*window.innerHeight),o={INLINED:"INLINED",FULL_SCREEN:"FULL_SCREEN",CORNER:"CORNER"};class a{constructor({allowedRenderModes:e=[]}={}){this.allowedRenderModes=e,this.lastShownTimestamps=this._loadTimestamps()}_loadTimestamps(){try{var e=localStorage.getItem("tinyadz_lastShownTimestamps");return e?JSON.parse(e):{FULL_SCREEN:null}}catch(e){return{FULL_SCREEN:null}}}_saveTimestamps(){localStorage.setItem("tinyadz_lastShownTimestamps",JSON.stringify(this.lastShownTimestamps))}trackAdShown(e){var t=Date.now();e===o.FULL_SCREEN&&(this.lastShownTimestamps.FULL_SCREEN=t,this._saveTimestamps())}checkIfAllowed(e){var t=Date.now();if(!this.allowedRenderModes.includes(e))return!1;switch(e){case o.INLINED:return!0;case o.FULL_SCREEN:var i=this.lastShownTimestamps[o.FULL_SCREEN];return!i||18e5<=t-i;case o.CORNER:return this.allowedRenderModes.includes(o.FULL_SCREEN)?(i=this.lastShownTimestamps.FULL_SCREEN)&&1e4<=t-i:!0;default:return!1}}}class r{constructor({selectors:e=[`[${g}]`],rootMargin:t="200px",threshold:i=.1,onNewContainerAppeared:n=null,placements:s,maxSlotsPerPage:a}={}){this.placements=s||[],this.maxSlotsPerPage=a||5,this.selectors=e,this.adSlotCounter=0,this.onNewContainerAppeared=n||this.defaultHandler;s=document.querySelector("#TA_AD_CONTAINER");s&&(s.setAttribute(g,"true"),s.removeAttribute("id")),this.placements.length&&this.addSlots(this.placements,this.maxSlotsPerPage),this.adObserver=new IntersectionObserver(this.handleAdIntersection.bind(this),{rootMargin:t,threshold:i}),this.mutationObserver=new MutationObserver(this.handleMutations.bind(this)),this.observeExistingContainers(),this.observeDOMMutations(),this.triggerVisibleOnLoad()}addSlots(e,c){let u=.8*window.innerHeight;let m=0;e.forEach(({selector:t,placement:d,cssClasses:h})=>{m;try{let e=[];(e=t.includes(":contains")?function(e){var t=/:contains\\((['"])(.*?)\\1\\)/,i=e.match(t);if(!i)return Array.from(document.querySelectorAll(e));let n=i[2];return i=e.replace(t,""),Array.from(document.querySelectorAll(i)).filter(e=>e.textContent.includes(n))}(t):document.querySelectorAll(t)).forEach(e=>{if(!(m>=c))if(e&&e.parentElement){var{width:i,top:n}=e.parentElement.getBoundingClientRect(),{paddingLeft:s,paddingRight:a}=window.getComputedStyle(e.parentElement),i=i-parseFloat(s)-parseFloat(a);if(n+window.scrollY<u)return console.warn("To close to the top placement for ",d),!1;if(i<250)return console.warn("To narrow container for",d),!1;if(e.nextSibling?.attributes&&void 0!==e.nextSibling.attributes[g])return console.warn("Attempt to another add at the same container",d),!1;var r,o=e.getBoundingClientRect();for(r of document.querySelectorAll(`[${g}]`)){var l=r.getBoundingClientRect();if(Math.abs(l.top-o.top)<350)return console.warn("Too close to another ad",d),!1}let t=document.createElement("div");t.setAttribute(g,!0),h?.length&&h.forEach(e=>t.classList.add(e.replace(/\./,""))),e.parentElement.insertBefore(t,e.nextSibling),m++}else console.warn("Ad target not found for:",d)})}catch(e){}})}getNewContainerId(){return"ta-container-"+this.adSlotCounter++}removeSlot(e){e&&e.remove&&e.remove()}triggerVisibleOnLoad(){this.selectors.map(e=>Array.from(document.querySelectorAll(e))).flat().filter(e=>this.isElementVisible(e)).forEach(e=>{this.onSlotVisible(e)})}handleAdIntersection(e){e.forEach(e=>{e.isIntersecting&&(e=e.target,this.onSlotVisible(e))})}onSlotVisible(e){e.dataset.filled||(e.dataset.filled=!0,e.id||(e.id=this.getNewContainerId()),this.onNewContainerAppeared({containerRef:e}))}handleMutations(e){for(var t of e)t.addedNodes.forEach(e=>{1===e.nodeType&&(e.hasAttribute?.("tinyadz-ad-container")?this.observeAdContainer(e):this.observeAdContainers(e))})}observeAdContainer(e){this.adObserver.observe(e)}observeAdContainers(e=document){this.selectors.map(e=>Array.from(document.querySelectorAll(e))).flat().forEach(e=>this.observeAdContainer(e))}observeExistingContainers(){this.observeAdContainers()}observeDOMMutations(){var e=this._debounceMutations(this.handleMutations.bind(this),100);this.mutationObserver=new MutationObserver(e),this.mutationObserver.observe(document.body,{childList:!0,subtree:!0})}_debounceMutations(t,i){let n=null,s=[];return function(e){s.push(...e),clearTimeout(n),n=setTimeout(()=>{t(s),s=[]},i)}}defaultHandler(e){console.warn("No onNewContainerAppeared handler defined for:",e)}isElementVisible(e){e=e.getBoundingClientRect();return e.top<window.innerHeight&&0<e.bottom&&e.left<window.innerWidth&&0<e.right}disconnect(){this.adObserver.disconnect(),this.mutationObserver.disconnect()}}class l{constructor({idleTimeout:e=3e4,updateIntervalMs:t=1e3,maxPointerPoints:i=30,curvatureAngleDeg:n=15,onUpdate:s=()=>{}}={}){this.idleTimeout=e,this.updateIntervalMs=t,this.maxPointerPoints=i,this.curvatureAngleDeg=n,this.onUpdate=s,this._listeners=[],this._updateTimer=null,this._idleTimer=null,this._running=!1,this.resetState()}resetState(){var e=Date.now();this.pointerPath=[],this.scrollDepth=0,this.scrollSpeeds=[],this._lastScrollY=window.scrollY||0,this._lastScrollTs=e,this.mouseMovementStats={totalDistance:0,speeds:[],curvatures:0},this.clickStreak=0,this.activityBuffer=[],this.isIdle=!1,this.lastActiveTime=e,this.isTabVisible=!document.hidden,this.orientationChanges=0,this.startTime=e,this._lastAngle=null}startTracking(){this._running||(this._running=!0,this._add(window,"pointermove",this._onPointerMove,{passive:!0}),this._add(window,"pointerdown",this._onClick,{passive:!0}),this._add(window,"scroll",this._onScroll,{passive:!0}),this._add(document,"visibilitychange",this._onVisibility,{passive:!0}),this._add(window,"orientationchange",this._onOrientation,{passive:!0}),this._idleTimer=setInterval(()=>this._detectIdle(),1e3),this._updateTimer=setInterval(()=>{try{this.onUpdate(this.getSnapshot())}catch(e){console.warn("Error in onUpdate callback",e)}},this.updateIntervalMs))}stopTracking(){this._running&&(this._running=!1,this._listeners.forEach(({target:e,event:t,handler:i,opts:n})=>{e.removeEventListener(t,i,n)}),this._listeners=[],clearInterval(this._idleTimer),clearInterval(this._updateTimer),this._idleTimer=null,this._updateTimer=null)}destroy(){this.stopTracking()}getSnapshot(){var e=Date.now();return{ts:e,idle:this.isIdle,timeActiveMs:e-this.startTime,scrollStats:{scrollDepth:this.scrollDepth,speedAvg:this._avg(this.scrollSpeeds),speedVariance:this._variance(this.scrollSpeeds)},pointerStats:{path:this.pointerPath.slice(0,10),totalDistance:this.mouseMovementStats.totalDistance,speedAvg:this._avg(this.mouseMovementStats.speeds),speedVariance:this._variance(this.mouseMovementStats.speeds),curvatures:this.mouseMovementStats.curvatures},clicks:this.clicks,activityBuffer:this.activityBuffer.slice(),isTabVisible:this.isTabVisible,orientationChanges:this.orientationChanges}}_add(e,t,i,n){i=i.bind(this);e.addEventListener(t,i,n),this._listeners.push({target:e,event:t,handler:i,opts:n})}_detectIdle(){var e=Date.now(),t=this.isIdle;this.isIdle=e-this.lastActiveTime>this.idleTimeout,this.isIdle!==t&&"function"==typeof this.onUpdate&&this.onUpdate(this.getSnapshot())}_registerActivity(){this.lastActiveTime=Date.now(),this.isIdle=!1}_onPointerMove(e){this._registerActivity();var t=Date.now(),e={x:e.clientX,y:e.clientY,t:t},t=this.pointerPath;if(t.length){var i=t[t.length-1],n=e.x-i.x,s=e.y-i.y,a=Math.hypot(n,s),i=Math.max(1,e.t-i.t)/1e3,a=(this.mouseMovementStats.totalDistance+=a,a/i),i=(this.mouseMovementStats.speeds.push(a),100<this.mouseMovementStats.speeds.length&&this.mouseMovementStats.speeds.shift(),Math.atan2(s,n));if(null!=this._lastAngle){let e=Math.abs(i-this._lastAngle);for(;e>Math.PI;)e-=2*Math.PI;Math.abs(e)>=this.curvatureAngleDeg*Math.PI/180&&this.mouseMovementStats.curvatures++}this._lastAngle=i}else this._lastAngle=null;t.push(e),t.length>this.maxPointerPoints&&t.shift()}_onClick(e){this._registerActivity(),this.clicks++;var t={tagName:e.target?.tagName,id:e.target?.id||null,classes:e.target?.className||null};this.activityBuffer.push({x:e.clientX,y:e.clientY,action:"CLICK",t:Date.now(),elem:t}),10<this.activityBuffer.length&&this.activityBuffer.shift()}_onScroll(){this._registerActivity();var e=Date.now(),t=window.scrollY||0,i=Math.abs(t-this._lastScrollY),n=Math.max(1,e-this._lastScrollTs)/1e3;this.scrollSpeeds.push(i/n),this.scrollDepth=Math.max(this.scrollDepth,t),this._lastScrollY=t,this._lastScrollTs=e}_onVisibility(){this.isTabVisible=!document.hidden,this._registerActivity()}_onOrientation(){this.orientationChanges++,this._registerActivity()}_avg(e){return e.length?e.reduce((e,t)=>e+t,0)/e.length:0}_variance(e){if(e.length<2)return 0;let i=this._avg(e);return e.reduce((e,t)=>e+(t-i)**2,0)/e.length}}if(void 0===window.$tam){let e=location.href;function d(){location.href!==e&&(e=location.href,void 0!==window.$tam)&&setTimeout(()=>{window.$tam.requestNextAd()},100)}let t=new class{constructor(e){this.siteId=e,this.config$=this.setupSite(),this.adsRendering={},this.availableAds=[],this.engagement$=null,this.adsFetching$=null,this.recentAdFetchingResponses={},this.adSlotCounter=0,this.allowedRenderModes=[],this.engagementManager=new l({updateIntervalMs:100,onUpdate:e=>{window.$ta&&window.$ta.captureVisitorEngagement(e)}}),this.engagementManager.startTracking()}waitForUserEngagement(c=3e3,u=n){return new Promise(e=>{let t=!1,i=!1,n=0,s=!1,a=()=>{window.removeEventListener("scroll",l,{passive:!0}),document.removeEventListener("mousemove",h,!0),document.removeEventListener("touchmove",d,{passive:!0})},r=(e,t)=>{e=document.elementFromPoint(e,t);return!!e&&!!e.closest&&!!e.closest("iframe.tinyadz-iframe")},o=()=>{t&&i&&n>=u&&!s&&(a(),e())},l=()=>{(window.scrollY??window.pageYOffset??document.documentElement.scrollTop??0)>=m&&(i=!0,o())},d=e=>{e=e.changedTouches&&e.changedTouches[0];e&&(s=r(e.clientX,e.clientY)),(n+=1)>=u&&o()},h=e=>{s=r(e.clientX,e.clientY),(n+=1)>=u&&o()};setTimeout(()=>{t=!0,o()},c),window.addEventListener("scroll",l,{passive:!0}),document.addEventListener("mousemove",h,!0),document.addEventListener("touchmove",d,{passive:!0}),l()})}async requestNextAd({renderModes:e}={}){return this.showAds({renderModes:e})}async onNewContainerDetected({containerRef:e}){return this.showAds({containerRef:e})}async showAds({containerRef:t=null,renderModes:i=null}={}){this.engagement$||(this.engagement$=this.waitForUserEngagement()),await this.engagement$,i||await this.fetchAds();var n=await this.config$;if(n.enabled){let e=[...this.allowedRenderModes];0<i?.length?e=i:t&&(e=e.filter(e=>e===o.INLINED));for(var s of e=e.filter(e=>this.adRenderModesController.checkIfAllowed(e)))try{var a=n.theme||"light",r=""+s+(t?"-"+t.id:"");if(this.adsRendering[r]||!1)return;this.fetchAndRenderAds({renderingKey:r,renderMode:s,theme:a,containerRef:t})}catch(e){console.error(e)}}else console.warn("TinyAdz script exit as WebSite Ad Module is disabled")}async fetchAndRenderAds({renderingKey:e,renderMode:t,theme:i,containerRef:n}){try{var s;if(!this.adsRendering[e])return this.adsRendering[e]=!0,s=await this.getNextAd(t),await this.renderAd(s,t,i,n)}catch(e){console.error("TinyAdz init failed",e)}finally{this.adsRendering[e]=!1}}loadScripts(){var e=[this.loadManagerScript()];return Promise.all(e)}loadScript(n,s){return new Promise((e,t)=>{if(document.getElementById(s))return e();var i=document.createElement("script");i.id=s,i.src=n,i.async=!0,i.onload=()=>{e()},i.onerror=e=>t(new Error("Failed to load ta script"+s+". "+e?.message)),document.head.appendChild(i)})}loadManagerScript(){return this.loadScript("https://cdn.apitiny.net/scripts/v2.0/manager.js?hostType=ads","TINYADZ-WIDGET-MANAGER-SCRIPT")}async setupSite(){try{await this.loadBotDetectionFrame();var e=new URLSearchParams({siteId:this.siteId,pageUrl:location.href,refererUrl:document.referrer,width:window.innerWidth,height:window.innerHeight}).toString(),n=(await(await fetch(s.GET_SITE_CONFIG+"?"+e)).json())["config"];if(await this.loadScripts(),this.allowedRenderModes=n.widgets.map(({renderMode:e})=>e),this.adRenderModesController=new a({allowedRenderModes:this.allowedRenderModes}),n.widgets.find(({renderMode:e})=>e===o.INLINED)){n.placementConfig||(n.placementConfig={placements:[],maxSlotsPerPage:3});let{placements:t,maxSlotsPerPage:i}=n["placementConfig"];await new Promise(e=>{setTimeout(()=>{this.inlineAdsContainerManager=new r({onNewContainerAppeared:this.onNewContainerDetected.bind(this),placements:t,maxSlotsPerPage:i}),e()},1e3)})}return n}catch(e){return console.error("Failed to fetch TinyAdz config",e),{enabled:!1}}}loadBotDetectionFrame(){return new Promise(t=>{try{var e="https://cdn.apitiny.net/bot-detection?siteId="+this.siteId,i=document.createElement("iframe");i.src=e,i.width="0",i.height="0",i.style.display="none",i.style.border="0",i.referrerPolicy="no-referrer-when-downgrade",i.allow="autoplay; fullscreen",document.body.appendChild(i),t()}catch(e){console.err("Validation Iframe installation failed"),t()}})}async fetchAds(i){if(this.adsFetching$&&await this.adsFetching$,this.availableAds=this.availableAds.filter(e=>e.expiresAt>Date.now()),!(!i&&0<this.availableAds.length||i&&this.availableAds.some(e=>e.renderMode===i))){var e=this.recentAdFetchingResponses[i||"all"];if(e){var{date:e,ads:t}=e,e=3e5<Date.now()-e,t=0===t.length;if(e&&t)return[]}this.adsFetching$=new Promise(async e=>{var t=new URLSearchParams({siteId:this.siteId,renderMode:i||"",pageUrl:location.href,width:window.innerWidth,height:window.innerHeight}).toString(),t=(await(await fetch(s.GET_AS+"?"+t)).json())["ads"];this.availableAds.push(...t),this.recentAdFetchingResponses[i||"all"]={ads:t,date:Date.now()},e(t)}),await this.adsFetching$}return this.availableAds}async getNextAd(i){try{this.adsFetching$&&await this.adsFetching$;let t=this.availableAds.find(e=>e.renderMode===i&&e.expiresAt>Date.now());return t||await this.fetchAds(i),(t=this.availableAds.find(e=>e.renderMode===i))&&(this.availableAds=this.availableAds.filter(e=>e!==t)),t}catch(e){return console.error("Failed to fetch available ads",e),null}}async waitForContainer(t,i=3,n=1e3){for(let e=0;e<i;e++){var s=document.querySelector(t);if(s)return s;e<i-1&&await new Promise(e=>setTimeout(e,n))}return null}async renderAd(e,t=o.FULL_SCREEN,i="light",n=null){if(e)if($ta)try{var{widgetId:s,snapshotId:a}=e;switch(this.adRenderModesController.trackAdShown(t),t){case o.INLINED:return n?void $ta.renderInlined(s,{snapshotId:a,theme:i,renderMode:t,container:n}):void console.warn("Ad container is not provided for ad placement");case o.CORNER:var r=await this.waitForContainer("body",10,150);return r?void $ta.renderInlined(s,{snapshotId:a,theme:i,renderMode:t,container:r}):void console.warn("Ad container not found after retries");case o.FULL_SCREEN:$ta.showPopup(s,null,{snapshotId:a,theme:i,renderMode:t})}}catch(e){console.error("Failed to fetch available ads",e)}else console.warn("Ads are not visible as manager script is not loaded");else t===o.INLINED&&n&&this.inlineAdsContainerManager.removeSlot(n)}renderAdsOnUserInteraction(){return this.waitForUserEngagement(15e3,2*n).then(()=>{this.requestNextAd({renderModes:[o.CORNER,o.FULL_SCREEN]}),this.renderAdsOnUserInteraction()})}}(i);window.tam=window.$tam={requestNextAd:t.requestNextAd.bind(t)},t.config$.then(async()=>{await t.fetchAds();{var i=d;let e=history.pushState,t=(history.pushState=function(){e.apply(this,arguments),i()},history.replaceState);history.replaceState=function(){t.apply(this,arguments),i()},window.addEventListener("popstate",i)}await t.requestNextAd(),setTimeout(()=>{t.allowedRenderModes.find(e=>e===o.CORNER)&&t.renderAdsOnUserInteraction()},1e4)})}}let currentScript=document.currentScript||(()=>{var t=document.getElementsByTagName("script");for(let e=t.length-1;0<=e;e--)if(t[e].getAttribute("src")?.includes("main.js")&&Boolean(t[e].getAttribute("site-id")))return t[e];return null})();"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>init(currentScript)):init(currentScript);